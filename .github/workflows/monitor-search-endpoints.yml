name: monitor-search-endpoints

on:
  workflow_dispatch:
  schedule:
    # hourly (minute 7)
    - cron: "7 * * * *"

permissions:
  contents: write

jobs:
  monitor:
    runs-on: ubuntu-latest
    steps:
      - name: Check search endpoints
        shell: bash
        run: |
          set -e
          FAIL=0

          check () {
            URL="$1"
            CODE=$(curl -s -o /dev/null -w "%{http_code}" "$URL" || echo 000)
            echo "$URL -> $CODE"
            if [ "$CODE" != "200" ]; then
              FAIL=1
            fi
          }

          check https://search.onetoo.eu/
          check https://search.onetoo.eu/openapi.json
          check "https://search.onetoo.eu/search/v1?q=test"

          if [ "$FAIL" = "1" ]; then
            echo "::warning ::search.onetoo.eu is offline (404/5xx). Core trust-root remains valid."
          else
            echo "search.onetoo.eu is ONLINE"
          fi
